

{% extends 'main/base.html' %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Green Volunteer Network</h1>
    <h2 class="mb-4">Volunteer Opportunities</h2>

    <!-- Search Bar -->
    <div class="mb-4">
        <div class="input-group">
            <input type="text" class="form-control" id="search-input" name="q" value="{{ request.GET.q }}" placeholder="Search opportunities..." aria-label="Search" aria-describedby="search-addon">
            <button class="btn btn-primary" type="button" onclick="submitForm()">Search</button>
            <button id="clear-btn" class="btn btn-secondary" type="button" style="display: none;" onclick="clearSearch()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <!-- Suggestions Dropdown -->
        <div id="suggestions" class="list-group mt-2" style="display: none;"></div>
    </div>

    <!-- Volunteer Opportunities List -->
    <div class="row" id="opportunity-list">
        {% for opportunity in opportunities %}
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title">{{ opportunity.title }}</h5>
                        <p class="card-text">{{ opportunity.description }}</p>
                        <p class="card-text"><small class="text-muted">{{ opportunity.organization.name }}</small></p>
                        <p class="card-text"><small class="text-muted">{{ opportunity.location }}</small></p>
                        <p class="card-text"><small class="text-muted">{{ opportunity.date }}</small></p>
                        <a href="{% url 'opportunity_detail' opportunity.pk %}" class="btn btn-primary">Learn More</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<script>
    function submitForm() {
        const searchInput = document.getElementById('search-input');
        const query = searchInput.value.trim();
        if (query) {
            window.location.href = `/?q=${encodeURIComponent(query)}`;
        }
    }

    function clearSearch() {
        const searchInput = document.getElementById('search-input');
        searchInput.value = '';
        window.location.href = '/';  // Redirect to home without search query
    }

    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('search-input');
        const clearBtn = document.getElementById('clear-btn');
        const suggestionsDropdown = document.getElementById('suggestions');

        searchInput.addEventListener('input', function() {
            const query = searchInput.value.trim();
            clearBtn.style.display = query.length > 0 ? 'block' : 'none';
            if (query.length > 0) {
                fetchSuggestions(query);
            } else {
                suggestionsDropdown.style.display = 'none';
            }
        });

        function fetchSuggestions(query) {
            fetch(`/search_suggestions/?q=${encodeURIComponent(query)}`)
                .then(response => response.json())
                .then(data => {
                    suggestionsDropdown.innerHTML = '';
                    if (data.suggestions.length > 0) {
                        data.suggestions.forEach(suggestion => {
                            const item = document.createElement('a');
                            item.href = `/?q=${encodeURIComponent(suggestion)}`;
                            item.className = 'list-group-item list-group-item-action';
                            item.textContent = suggestion;
                            suggestionsDropdown.appendChild(item);
                        });
                        suggestionsDropdown.style.display = 'block';
                    } else {
                        suggestionsDropdown.style.display = 'none';
                    }
                });
        }

        // Hide suggestions when clicking outside
        document.addEventListener('click', function(event) {
            if (!searchInput.contains(event.target) && !suggestionsDropdown.contains(event.target)) {
                suggestionsDropdown.style.display = 'none';
            }
        });

        // Initial state check for clear button
        clearBtn.style.display = searchInput.value.trim().length > 0 ? 'block' : 'none';
    });
</script>
{% endblock %}
